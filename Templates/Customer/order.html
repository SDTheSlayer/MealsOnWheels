{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->

    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/5.9.4/firebase-app.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/5.9.4/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.4/firebase-database.js"></script>


{#    <script src="https://www.gstatic.com/firebasejs/5.9.4/firebase.js"></script>#}
    <script>
        // Initialize Firebase
        const config = {
            apiKey: "AIzaSyC6MLEYIZxv7DHhs-vtmCB3rLkd1y2r3bI",
            authDomain: "mealsonwheelsiit.firebaseapp.com",
            databaseURL: "https://mealsonwheelsiit.firebaseio.com",
            projectId: "mealsonwheelsiit",
            storageBucket: "mealsonwheelsiit.appspot.com",
            messagingSenderId: "755544742392"
        };
        firebase.initializeApp(config) ;


        const database = firebase.database() ;
        const not_delivered =  database.ref('Transactions/notDelivered') ;
        not_delivered.on('value', function (snapshot) {
            var obj = snapshot.val() ;
            var flag = false;
          for(var transaction in obj){
                if(!obj.hasOwnProperty(transaction)) continue;
                if(transaction===document.getElementById('uid').innerText) {
                    var temp = "none";
                    document.getElementById('delivererlocation').innerText = obj[transaction].delivererLocation;
                    document.getElementById('status').innerText = obj[transaction].status;
                    document.getElementById('customerLocation').innerText = obj[transaction].customerLocation;
                    if (obj[transaction].status === 'picked'){
                        temp = "";
                    }
                    document.getElementById('myMapdisplay').style.display=temp;
                    flag=true;

                }


            }
            if(flag===false)
                {
                    alert("Order Delivered");
                    location.href="/";
                }
          GetMap();
          GetMapdisplay();
        })
    </script>
     <script type='text/javascript'>
        function GetMapdisplay() {
            if (document.getElementById('myMapdisplay').style.display!=="none") {

                var map = new Microsoft.Maps.Map('#myMapdisplay', {
                    credentials: 'ArQm8xOmwjqUgQPxLjEhNC4IYi1IC_1xmg3qhqPygrszIk-RLEB6wfir6-7m1kBO'
                });

                var deliverer = new Microsoft.Maps.Location.parseLatLong(document.getElementById('delivererlocation').innerText);
                var customer = new Microsoft.Maps.Location.parseLatLong(document.getElementById('customerLocation').innerText);
                //Add a green pushpin that has dragging enabled and events attached to it.
                var bluePin = new Microsoft.Maps.Pushpin(deliverer, {color: '#00f', draggable: false});
                map.entities.push(bluePin);
                var redPin = new Microsoft.Maps.Pushpin(customer, {color: '#ff0000', draggable: false});
                map.entities.push(redPin);
                map.setView({
                    zoom: 13
                });
            }
        }
    </script>
    <script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=GetMapdisplay' defer></script>
    <script type='text/javascript'>
        var map;
        var directionsManager;
        function GetMap()
        {
            if (document.getElementById('myMapdisplay').style.display!=="none"){
                map = new Microsoft.Maps.Map('#myMap', {});
                //Load the directions module.
                Microsoft.Maps.loadModule('Microsoft.Maps.Directions', function () {
                    //Create an instance of the directions manager.
                    directionsManager = new Microsoft.Maps.Directions.DirectionsManager(map);
                    directionsManager.setRequestOptions({
                        routeMode: Microsoft.Maps.Directions.RouteMode.driving
                    });
                    //Create waypoints to route between.
                    var loc1 = new Microsoft.Maps.Location.parseLatLong(document.getElementById('delivererlocation').innerText);
                    var loc2 = new Microsoft.Maps.Location.parseLatLong(document.getElementById('customerLocation').innerText);
                    var seattleWaypoint = new Microsoft.Maps.Directions.Waypoint({address: 'Deliverer' ,location:loc1});
                    var bluePin = new Microsoft.Maps.Pushpin(loc1, { color: '#00f', draggable: true });
                    map.entities.push(bluePin);
                    directionsManager.addWaypoint(seattleWaypoint);
                    var workWaypoint = new Microsoft.Maps.Directions.Waypoint({ address:'Customer',location:loc2 });
                    directionsManager.addWaypoint(workWaypoint);
                    //Add event handlers to directions manager.
                    Microsoft.Maps.Events.addHandler(directionsManager, 'directionsError', directionsError);
                    Microsoft.Maps.Events.addHandler(directionsManager, 'directionsUpdated', directionsUpdated);
                    //Calculate directions.
                    directionsManager.calculateDirections();
                });
            }
        }
        function directionsUpdated(e) {
            //Get the current route index.
            var routeIdx = directionsManager.getRequestOptions().routeIndex;
            //Get the distance of the route, rounded to 2 decimal places.
            var distance = Math.round(e.routeSummary[routeIdx].distance * 100)/100;
            //Get the distance units used to calculate the route.
            var units = directionsManager.getRequestOptions().distanceUnit;
            var distanceUnits = '';
            if (units == Microsoft.Maps.Directions.DistanceUnit.km) {
                distanceUnits = 'km'
            } else {
                //Must be in miles
                distanceUnits = 'miles'
            }
            //Time is in seconds, convert to minutes and round off.
            var time = Math.round(e.routeSummary[routeIdx].timeWithTraffic / 60);
            document.getElementById('routeInfoPanel').innerHTML = 'Distance: ' + distance + ' ' + distanceUnits + '<br/>Time with Traffic: ' + time + ' minutes';
        }
        function directionsError(e) {
            alert('Error: ' + e.message + '\r\nResponse Code: ' + e.responseCode)
        }
    </script>
    <script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=ArQm8xOmwjqUgQPxLjEhNC4IYi1IC_1xmg3qhqPygrszIk-RLEB6wfir6-7m1kBO' defer></script>

    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>MealsOnWheels &mdash; Love your Hunger</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Food deliver website" />
	<meta name="keywords" content="food deliver website" />

  	<!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />

	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet">

	<!-- Animate.css -->
	<link rel="stylesheet" href="{% static 'css/animate.css' %}">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="{% static 'css/icomoon.css' %}">
	<!-- Themify Icons-->
	<link rel="stylesheet" href="{% static 'css/themify-icons.css' %}">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">

	<!-- Magnific Popup -->
	<link rel="stylesheet" href="{% static 'xss/magnific-popup.css' %}">

	<!-- Bootstrap DateTimePicker -->
	<link rel="stylesheet" href="{% static 'css/bootstrap-datetimepicker.min.css' %}">

	<!-- Owl Carousel  -->
	<link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}">
	<link rel="stylesheet" href="{% static 'css/owl.theme.default.min.css' %}">

	<!-- Theme style  -->
	<link rel="stylesheet" href="{% static 'css/style.css' %}">

	<!-- Modernizr JS -->
	<script src="{% static 'js/modernizr-2.6.2.min.js' %}"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>-->
	<script src="{% static 'js/respond.min.js' %}"></script>

</head>
<body >

	<nav class="gtco-nav" role="navigation">
		<div class="gtco-container">

			<div class="row">
				<div class="col-sm-4 col-xs-12">
                   <div id="gtco-logo"> <span class="icon">
							<i class="ti-truck"></i>
					</span><a href="{% url 'Customer:home' %}">Meals On Wheels <em>.</em></a></div>
				</div>
				<div class="col-xs-8 text-right menu-1">
					<ul>
                        <li><a href="{% url 'Customer:home' %}">Home</a></li>

						<li class="has-dropdown">
							<a href="#">Everything about you</a>
							<ul class="dropdown">
								<li><a href="{% url 'Customer:currentorders' %}">Current Orders</a></li>
								<li><a href="{% url 'Customer:profile' %}">Profile</a></li>
								<li><a href="{% url 'Customer:dashboard' %}">Dashboard</a></li>
							</ul>
						</li>
{#						<li><a href="#">Contact</a></li>#}

{#                        LOGOUT BUTTON#}
                        <li class="btn-cta"><a href="{% url 'Authentication:logout' %}"><span>Logout</span></a></li>
{#						<li class="btn-cta"><a href="{% url 'Customer:cart' %}"><span>Cart</span></a></li>#}
					</ul>
				</div>
			</div>

		</div>
	</nav>

    <header id="gtco-header" class="gtco-cover-xs gtco-cover" style="background-image: url({% static 'images/img_bg_1.jpg' %})" data-stellar-background-ratio="0.5">
		<div class="overlay"></div>
		<div class="gtco-container">

				<div class="col-md-12 col-md-offset-0 text-center">
					<div class="row row1">

						<h2 class="col-md-12 mt-text animate-box" data-animate-effect="fadeInUp">
                        {% if user.is_authenticated %}
                            <h1 class="cursive-font">Track Order</h1><br>
                          <h2><span class="intro-text-small" style="font-weight: bold">Hello, <a href={% url 'Customer:profile' %} target="_blank">{{ user.first_name }} {{ user.last_name }}</a>
                          <br>Email : {{ user.email }}<br></span>
                            <br></h2>

                        {% else %}
{#                            #if customer is not logged in, give login button#}
                          <a class="lead" href="{% url 'Authentication:login' %}"><input type="button" class="btn btn-primary btn-block" value="Login!"></a>
	                    {% endif %}


						</div>



				</div>
			</div>
		</div>
	</header>

    <br><br>
<div class="col-md-8 text-center gtco-container">
    <div hidden id="myMap" style="position:relative;width:800px;height:600px;"></div>
    <div  class="col-md-8 text-center gtco-container" id="myMapdisplay" style="position:relative;width:800px;height:600px;"></div>
    <span hidden id="uid">{{ uid }}</span>
    <span hidden id="customerLocation"></span>

</div>
    <br><br>


<div class="text-center center-block text-justify col-lg-1">

<div class="card" style="width: 40rem;">
  <div class="card-header">
    Details:
  </div>
  <ul class="list-group list-group-flush">
    <li class="list-group-item"><span class="card-title" style="font-family: "Helvetica Neue", Helvetica, Arial, sans-serif">
        <h3>Restaurant : {{ order.vendorName }}</h3></span></li>
    <li class="list-group-item">Date: {{ order.date }}</li>
    <li class="list-group-item">Deliverer : {{ order.delivererName }}</li>
    <li class="list-group-item">Order Summary:<br>
    {% for i,j in order.itemsOrdered.items %}
        {{ i }}<br>
        <ul>{% for k,l in j.items %}

            <li>{{ k }}:{{ l }}</li>

        {% endfor %}</ul>
    {% endfor %}
    </li>
    <li class="list-group-item">
        Payment Mode : {{ order.paymentMode }}</li>
      <li class="list-group-item">Total : â‚¹{{ order.totalAmount }}</li>
      <li class="list-group-item">Status : <span id="status">{{ order.status }}</span></li>
    <li class="list-group-item">Estimated Delivery: <br>
    <div id='routeInfoPanel'></div>
    <span id="test"></span>
        <span hidden id="delivererlocation"  ></span>


    </li>
  </ul>
</div>




    <br><br>


    </div>


<footer id="gtco-footer" role="contentinfo" style="background-image: url({% static 'images/img_bg_1.jpg' %})" data-stellar-background-ratio="0.5">
		<div class="overlay"></div>
		<div class="gtco-container">
			<div class="row row-pb-md">




				<div class="col-md-12 text-center">
					<div class="gtco-widget">
						<h3>Get In Touch</h3>
						<ul class="gtco-quick-contact">
							<li><a href="#"><i class="icon-phone"></i> +1 234 567 890</a></li>
							<li><a href="#"><i class="icon-mail2"></i> mealsonwheelsiitg@gmail.com</a></li>
							<li><a href="#"><i class="icon-chat"></i> Live Chat</a></li>
						</ul>
					</div>
					<div class="gtco-widget">
						<h3>Get Social</h3>
						<ul class="gtco-social-icons">
							<li><a href="#"><i class="icon-twitter"></i></a></li>
							<li><a href="#"><i class="icon-facebook"></i></a></li>
							<li><a href="#"><i class="icon-linkedin"></i></a></li>
							<li><a href="#"><i class="icon-dribbble"></i></a></li>
						</ul>
					</div>
				</div>



		</div>
	</footer>
	<!-- </div> -->

	</div>

	<div class="gototop js-top">
		<a href="#" class="js-gotop"><i class="icon-arrow-up"></i></a>
	</div>

	<!-- jQuery -->
	<script src="{% static 'js/jquery.min.js' %}"></script>
	<!-- jQuery Easing -->
	<script src="{% static 'js/jquery.easing.1.3.js' %}"></script>
	<!-- Bootstrap -->
	<script src="{% static 'js/bootstrap.min.js' %}"></script>
	<!-- Waypoints -->
	<script src="{% static 'js/jquery.waypoints.min.js' %}"></script>
	<!-- Carousel -->
	<script src="{% static 'js/owl.carousel.min.js' %}"></script>
	<!-- countTo -->
	<script src="{% static 'js/jquery.countTo.js' %}"></script>

	<!-- Stellar Parallax -->
	<script src="{% static 'js/jquery.stellar.min.js' %}"></script>

	<!-- Magnific Popup -->
	<script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script>
	<script src="{% static 'js/magnific-popup-options.js' %}"></script>

	<script src="{% static 'js/moment.min.js' %}"></script>
	<script src="{% static 'js/bootstrap-datetimepicker.min.js' %}"></script>


	<!-- Main -->
	<script src="{% static 'js/main.js' %}"></script>

	</body>
</html>